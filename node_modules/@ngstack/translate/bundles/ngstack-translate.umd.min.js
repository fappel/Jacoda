!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("@angular/platform-browser"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define("@ngstack/translate",["exports","@angular/core","@angular/common/http","@angular/platform-browser","rxjs","@angular/common"],e):e((t.ngstack=t.ngstack||{},t.ngstack.translate={}),t.ng.core,t.ng.common.http,t.ng.platformBrowser,t.rxjs,t.ng.common)}(this,function(t,n,r,e,a,o){"use strict";var c=function(){return(c=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function i(e,i,s,u){return new(s||(s=Promise))(function(t,n){function r(t){try{o(u.next(t))}catch(e){n(e)}}function a(t){try{o(u["throw"](t))}catch(e){n(e)}}function o(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(r,a)}o((u=u.apply(e,i||[])).next())})}function d(r,a){var o,i,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function n(t){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(s=2&t[0]?i["return"]:t[0]?i["throw"]||((s=i["return"])&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,i=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){u.label=t[1];break}if(6===t[0]&&u.label<s[1]){u.label=s[1],s=t;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(t);break}s[2]&&u.ops.pop(),u.trys.pop();continue}t=a.call(r,u)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}function y(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,a,o=n.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)i.push(r.value)}catch(s){a={error:s}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(a)throw a.error}}return i}var s=new n.InjectionToken("TRANSLATE_SETTINGS"),u=function(){function t(t,e){this.http=t,this.data={},this._fallbackLang="en",this._translationRoot="assets/i18n",this.activeLangChanged=new n.EventEmitter,this.debugMode=!1,this.disableCache=!1,this.supportedLangs=[],this.translatePaths=[],this.applySettings(e)}return Object.defineProperty(t.prototype,"fallbackLang",{get:function(){return this._fallbackLang},set:function(t){this._fallbackLang=t||"en"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeLang",{get:function(){return this._activeLang},set:function(t){var e=this,n=this._activeLang,r=t||this.fallbackLang;r!==n&&(this._activeLang=r,this.use(r).then(function(){e.activeLangChanged.next({previousValue:n,currentValue:r})}))},enumerable:!0,configurable:!0}),t.prototype.getBrowserLanguage=function(){return y(navigator.language.replace("-","_").toLowerCase().split("_"),1)[0]},Object.defineProperty(t.prototype,"translationRoot",{get:function(){return this._translationRoot},set:function(t){this._translationRoot=t||"assets/i18n"},enumerable:!0,configurable:!0}),t.prototype.applySettings=function(t){var e=this,n=e.debugMode,r=e.disableCache,a=e.supportedLangs,o=e.translatePaths,i=e.translationRoot,s=e.activeLang,u=c({debugMode:n,disableCache:r,supportedLangs:a,translatePaths:o,translationRoot:i,activeLang:s},t);this.debugMode=u.debugMode,this.disableCache=u.disableCache,this.supportedLangs=u.supportedLangs,this.translatePaths=u.translatePaths,this.translationRoot=u.translationRoot,this._activeLang=u.activeLang||this.getBrowserLanguage()},t.prototype.get=function(t,e,n){if(t){var r=this.getValue(n||this.activeLang,t);return r===t&&(r=this.getValue(this.fallbackLang,t)),this.format(r,e)}return null},t.prototype.load=function(){return i(this,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return[4,this.use(this.fallbackLang)];case 1:return t.sent(),[2,this.use(this.activeLang)]}})})},t.prototype.use=function(p,g){return i(this,void 0,void 0,function(){var e,a,o,i,s,u,c,l,f,h;return d(this,function(t){switch(t.label){case 0:if(p&&g)return[2,this.setTranslation(p,g)];if(o=this.data[p],this.isNotSupported(p)&&(o=this.data[this.fallbackLang]),o&&0<Object.keys(o).length)return[2,o];i=(p||this.fallbackLang)+".json",s=function n(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(y(arguments[e]));return t}([this.translationRoot],this.translatePaths||[]),t.label=1;case 1:t.trys.push([1,6,7,8]),u=function r(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}(s),c=u.next(),t.label=2;case 2:return c.done?[3,5]:(l=c.value,f=l+"/"+i,[4,this.loadTranslation(p,f)]);case 3:t.sent(),t.label=4;case 4:return c=u.next(),[3,2];case 5:return[3,8];case 6:return h=t.sent(),e={error:h},[3,8];case 7:try{c&&!c.done&&(a=u["return"])&&a.call(u)}finally{if(e)throw e.error}return[7];case 8:return[2,this.data[p]||{}]}})})},t.prototype.loadTranslation=function(n,t){var r=this;return new Promise(function(e){r.disableCache&&(t+="?v="+Date.now()),r.http.get(t).subscribe(function(t){e(r.setTranslation(n,t))},function(){e(r.data[n]||{})})})},t.prototype.isNotSupported=function(t){return t!==this.fallbackLang&&t!==this.activeLang&&this.supportedLangs&&0<this.supportedLangs.length&&!this.supportedLangs.includes(t)},t.prototype.getValue=function(t,e){var n=this.data[t];if(this.isNotSupported(t)&&(n=this.data[this.fallbackLang]),!n)return e;var r=e.split("."),a="";do{var o=n[a+=r.shift()];o===undefined||"object"!=typeof o&&r.length?r.length?a+=".":n=e:(n=o,a="")}while(r.length);return n},t.prototype.setTranslation=function(t,e){var n=this.data[t]||{};return n=this.merge(n,e||{}),this.data[t]=n},t.prototype.merge=function(){for(var n=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r={};return t.forEach(function(e){Object.keys(e).forEach(function(t){t in r&&Array.isArray(r[t])?r[t]=r[t].concat(e[t]):t in r&&"object"==typeof r[t]?r[t]=n.merge(r[t],e[t]):r[t]=e[t]})}),r},t.prototype.format=function(t,r){var a=t;return r&&Object.keys(r).forEach(function(t){var e=r[t],n=new RegExp("{"+t+"}","gm");a=a.replace(n,e)}),this.debugMode&&(a="["+this.activeLang+"] "+a),a},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r.HttpClient},{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[s]}]}]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t(n.inject(r.HttpClient),n.inject(s,8))},token:t,providedIn:"root"}),t}(),l=function(){function t(t,e){var n=this;this.title=t,this.translate=e,this._titleKey="",this.changed=new a.Subject,e.activeLangChanged.subscribe(function(){return n.onLanguageChanged()})}return t.prototype.getTitle=function(){return this._titleKey},t.prototype.setTitle=function(t){var e=this._titleKey,n=t||"";if(n!==e){this._titleKey=n;var r=this.translate.get(n);this.title.setTitle(r),this.changed.next({previousValue:e,currentValue:n})}},t.prototype.onLanguageChanged=function(){if(this._titleKey){var t=this.translate.get(this._titleKey);this.title.setTitle(t)}},t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:e.Title},{type:u}]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t(n.inject(e.Title),n.inject(u))},token:t,providedIn:"root"}),t}(),f=function(){function t(t){this.translate=t}return t.prototype.transform=function(t,e){return this.translate.get(t,e)},t.decorators=[{type:n.Pipe,args:[{name:"translate",pure:!1}]}],t.ctorParameters=function(){return[{type:u}]},t}(),h=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:s,useValue:t},u,l]}},e.forChild=function(){return{ngModule:e}},e.decorators=[{type:n.NgModule,args:[{imports:[o.CommonModule,r.HttpClientModule],declarations:[f],exports:[f]}]}],e}();t.TRANSLATE_SETTINGS=s,t.TranslateService=u,t.TitleService=l,t.TranslatePipe=f,t.TranslateModule=h,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngstack-translate.umd.min.js.map