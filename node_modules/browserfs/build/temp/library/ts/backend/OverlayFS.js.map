{"version":3,"file":"OverlayFS.js","sourceRoot":"","sources":["../../../../../src/backend/OverlayFS.ts"],"names":[],"mappings":"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","sourcesContent":["import {FileSystem, BaseFileSystem, BFSOneArgCallback, BFSCallback, FileSystemOptions} from '../core/file_system';\nimport {ApiError, ErrorCode} from '../core/api_error';\nimport {FileFlag, ActionType} from '../core/file_flag';\nimport {File} from '../core/file';\nimport {deprecationMessage} from '../core/util';\nimport {default as Stats} from '../core/node_fs_stats';\nimport PreloadFile from '../generic/preload_file';\nimport LockedFS from '../generic/locked_fs';\nimport * as path from 'path';\n/**\n * @hidden\n */\nconst deletionLogPath = '/.deletedFiles.log';\n\n/**\n * Given a read-only mode, makes it writable.\n * @hidden\n */\nfunction makeModeWritable(mode: number): number {\n  return 0o222 | mode;\n}\n\n/**\n * @hidden\n */\nfunction getFlag(f: string): FileFlag {\n  return FileFlag.getFileFlag(f);\n}\n\n/**\n * Overlays a RO file to make it writable.\n */\nclass OverlayFile extends PreloadFile<UnlockedOverlayFS> implements File {\n  constructor(fs: UnlockedOverlayFS, path: string, flag: FileFlag, stats: Stats, data: Buffer) {\n    super(fs, path, flag, stats, data);\n  }\n\n  public sync(cb: BFSOneArgCallback): void {\n    if (!this.isDirty()) {\n      cb(null);\n      return;\n    }\n\n    this._fs._syncAsync(this, (err: ApiError) => {\n      this.resetDirty();\n      cb(err);\n    });\n  }\n\n  public syncSync(): void {\n    if (this.isDirty()) {\n      this._fs._syncSync(this);\n      this.resetDirty();\n    }\n  }\n\n  public close(cb: BFSOneArgCallback): void {\n    this.sync(cb);\n  }\n\n  public closeSync(): void {\n    this.syncSync();\n  }\n}\n\n/**\n * *INTERNAL, DO NOT USE DIRECTLY!*\n *\n * Core OverlayFS class that contains no locking whatsoever. We wrap these objects\n * in a LockedFS to prevent races.\n */\nexport class UnlockedOverlayFS extends BaseFileSystem implements FileSystem {\n  public static isAvailable(): boolean {\n    return true;\n  }\n\n  private _writable: FileSystem;\n  private _readable: FileSystem;\n  private _isInitialized: boolean = false;\n  private _initializeCallbacks: (BFSOneArgCallback)[] = [];\n  private _deletedFiles: {[path: string]: boolean} = {};\n  private _deleteLog: string = '';\n  // If 'true', we have scheduled a delete log update.\n  private _deleteLogUpdatePending: boolean = false;\n  // If 'true', a delete log update is needed after the scheduled delete log\n  // update finishes.\n  private _deleteLogUpdateNeeded: boolean = false;\n  // If there was an error updating the delete log...\n  private _deleteLogError: ApiError | null = null;\n\n  constructor(writable: FileSystem, readable: FileSystem) {\n    super();\n    this._writable = writable;\n    this._readable = readable;\n    if (this._writable.isReadOnly()) {\n      throw new ApiError(ErrorCode.EINVAL, \"Writable file system must be writable.\");\n    }\n  }\n\n  public getOverlayedFileSystems(): { readable: FileSystem; writable: FileSystem; } {\n    return {\n      readable: this._readable,\n      writable: this._writable\n    };\n  }\n\n  public _syncAsync(file: PreloadFile<UnlockedOverlayFS>, cb: BFSOneArgCallback): void {\n    this.createParentDirectoriesAsync(file.getPath(), (err?: ApiError) => {\n      if (err) {\n        return cb(err);\n      }\n      this._writable.writeFile(file.getPath(), file.getBuffer(), null, getFlag('w'), file.getStats().mode, cb);\n    });\n  }\n\n  public _syncSync(file: PreloadFile<UnlockedOverlayFS>): void {\n    this.createParentDirectories(file.getPath());\n    this._writable.writeFileSync(file.getPath(), file.getBuffer(), null, getFlag('w'), file.getStats().mode);\n  }\n\n  public getName() {\n    return OverlayFS.Name;\n  }\n\n  /**\n   * Called once to load up metadata stored on the writable file system.\n   */\n  public initialize(cb: BFSOneArgCallback): void {\n    const callbackArray = this._initializeCallbacks;\n\n    const end = (e?: ApiError): void => {\n      this._isInitialized = !e;\n      this._initializeCallbacks = [];\n      callbackArray.forEach(((cb) => cb(e)));\n    };\n\n    // if we're already initialized, immediately invoke the callback\n    if (this._isInitialized) {\n      return cb();\n    }\n\n    callbackArray.push(cb);\n    // The first call to initialize initializes, the rest wait for it to complete.\n    if (callbackArray.length !== 1) {\n      return;\n    }\n\n    // Read deletion log, process into metadata.\n    this._writable.readFile(deletionLogPath, 'utf8', getFlag('r'), (err: ApiError, data?: string) => {\n      if (err) {\n        // ENOENT === Newly-instantiated file system, and thus empty log.\n        if (err.errno !== ErrorCode.ENOENT) {\n          return end(err);\n        }\n      } else {\n        this._deleteLog = data!;\n      }\n      this._reparseDeletionLog();\n      end();\n    });\n  }\n\n  public isReadOnly(): boolean { return false; }\n  public supportsSynch(): boolean { return this._readable.supportsSynch() && this._writable.supportsSynch(); }\n  public supportsLinks(): boolean { return false; }\n  public supportsProps(): boolean { return this._readable.supportsProps() && this._writable.supportsProps(); }\n\n  public getDeletionLog(): string {\n    return this._deleteLog;\n  }\n\n  public restoreDeletionLog(log: string): void {\n    this._deleteLog = log;\n    this._reparseDeletionLog();\n    this.updateLog('');\n  }\n\n  public rename(oldPath: string, newPath: string, cb: BFSOneArgCallback): void {\n    if (!this.checkInitAsync(cb) || this.checkPathAsync(oldPath, cb) || this.checkPathAsync(newPath, cb)) {\n      return;\n    }\n\n    if (oldPath === deletionLogPath || newPath === deletionLogPath) {\n      return cb(ApiError.EPERM('Cannot rename deletion log.'));\n    }\n\n    // nothing to do if paths match\n    if (oldPath === newPath) {\n      return cb();\n    }\n\n    this.stat(oldPath, false, (oldErr: ApiError, oldStats?: Stats) => {\n      if (oldErr) {\n        return cb(oldErr);\n      }\n\n      return this.stat(newPath, false, (newErr: ApiError, newStats?: Stats) => {\n        const self = this;\n        // precondition: both oldPath and newPath exist and are dirs.\n        // decreases: |files|\n        // Need to move *every file/folder* currently stored on\n        // readable to its new location on writable.\n        function copyDirContents(files: string[]): void {\n          const file = files.shift();\n          if (!file) {\n            return cb();\n          }\n\n          const oldFile = path.resolve(oldPath, file);\n          const newFile = path.resolve(newPath, file);\n\n          // Recursion! Should work for any nested files / folders.\n          self.rename(oldFile, newFile, (err?: ApiError) => {\n            if (err) {\n              return cb(err);\n            }\n            copyDirContents(files);\n          });\n        }\n\n        let mode = 0o777;\n\n        // from linux's rename(2) manpage: oldpath can specify a\n        // directory.  In this case, newpath must either not exist, or\n        // it must specify an empty directory.\n        if (oldStats!.isDirectory()) {\n          if (newErr) {\n            if (newErr.errno !== ErrorCode.ENOENT) {\n              return cb(newErr);\n            }\n\n            return this._writable.exists(oldPath, (exists: boolean) => {\n              // simple case - both old and new are on the writable layer\n              if (exists) {\n                return this._writable.rename(oldPath, newPath, cb);\n              }\n\n              this._writable.mkdir(newPath, mode, (mkdirErr?: ApiError) => {\n                if (mkdirErr) {\n                  return cb(mkdirErr);\n                }\n\n                this._readable.readdir(oldPath, (err: ApiError, files?: string[]) => {\n                  if (err) {\n                    return cb();\n                  }\n                  copyDirContents(files!);\n                });\n              });\n            });\n          }\n\n          mode = newStats!.mode;\n          if (!newStats!.isDirectory()) {\n            return cb(ApiError.ENOTDIR(newPath));\n          }\n\n          this.readdir(newPath, (readdirErr: ApiError, files?: string[]) => {\n            if (files && files.length) {\n              return cb(ApiError.ENOTEMPTY(newPath));\n            }\n\n            this._readable.readdir(oldPath, (err: ApiError, files?: string[]) => {\n              if (err) {\n                return cb();\n              }\n              copyDirContents(files!);\n            });\n          });\n        }\n\n        if (newStats && newStats.isDirectory()) {\n          return cb(ApiError.EISDIR(newPath));\n        }\n\n        this.readFile(oldPath, null, getFlag('r'), (err: ApiError, data?: any) => {\n          if (err) {\n            return cb(err);\n          }\n\n          return this.writeFile(newPath, data, null, getFlag('w'), oldStats!.mode, (err: ApiError) => {\n            if (err) {\n              return cb(err);\n            }\n            return this.unlink(oldPath, cb);\n          });\n        });\n      });\n    });\n  }\n\n  public renameSync(oldPath: string, newPath: string): void {\n    this.checkInitialized();\n    this.checkPath(oldPath);\n    this.checkPath(newPath);\n    if (oldPath === deletionLogPath || newPath === deletionLogPath) {\n      throw ApiError.EPERM('Cannot rename deletion log.');\n    }\n    // Write newPath using oldPath's contents, delete oldPath.\n    const oldStats = this.statSync(oldPath, false);\n    if (oldStats.isDirectory()) {\n      // Optimization: Don't bother moving if old === new.\n      if (oldPath === newPath) {\n        return;\n      }\n\n      let mode = 0o777;\n      if (this.existsSync(newPath)) {\n        const stats = this.statSync(newPath, false);\n        mode = stats.mode;\n        if (stats.isDirectory()) {\n          if (this.readdirSync(newPath).length > 0) {\n            throw ApiError.ENOTEMPTY(newPath);\n          }\n        } else {\n          throw ApiError.ENOTDIR(newPath);\n        }\n      }\n\n      // Take care of writable first. Move any files there, or create an empty directory\n      // if it doesn't exist.\n      if (this._writable.existsSync(oldPath)) {\n        this._writable.renameSync(oldPath, newPath);\n      } else if (!this._writable.existsSync(newPath)) {\n        this._writable.mkdirSync(newPath, mode);\n      }\n\n      // Need to move *every file/folder* currently stored on readable to its new location\n      // on writable.\n      if (this._readable.existsSync(oldPath)) {\n        this._readable.readdirSync(oldPath).forEach((name) => {\n          // Recursion! Should work for any nested files / folders.\n          this.renameSync(path.resolve(oldPath, name), path.resolve(newPath, name));\n        });\n      }\n    } else {\n      if (this.existsSync(newPath) && this.statSync(newPath, false).isDirectory()) {\n        throw ApiError.EISDIR(newPath);\n      }\n\n      this.writeFileSync(newPath,\n        this.readFileSync(oldPath, null, getFlag('r')), null, getFlag('w'), oldStats.mode);\n    }\n\n    if (oldPath !== newPath && this.existsSync(oldPath)) {\n      this.unlinkSync(oldPath);\n    }\n  }\n\n  public stat(p: string, isLstat: boolean, cb: BFSCallback<Stats>): void {\n    if (!this.checkInitAsync(cb)) {\n      return;\n    }\n    this._writable.stat(p, isLstat, (err: ApiError, stat?: Stats) => {\n      if (err && err.errno === ErrorCode.ENOENT) {\n        if (this._deletedFiles[p]) {\n          cb(ApiError.ENOENT(p));\n        }\n        this._readable.stat(p, isLstat, (err: ApiError, stat?: Stats) => {\n          if (stat) {\n            // Make the oldStat's mode writable. Preserve the topmost\n            // part of the mode, which specifies if it is a file or a\n            // directory.\n            stat = stat.clone();\n            stat.mode = makeModeWritable(stat.mode);\n          }\n          cb(err, stat);\n        });\n      } else {\n        cb(err, stat);\n      }\n    });\n  }\n\n  public statSync(p: string, isLstat: boolean): Stats {\n    this.checkInitialized();\n    try {\n      return this._writable.statSync(p, isLstat);\n    } catch (e) {\n      if (this._deletedFiles[p]) {\n        throw ApiError.ENOENT(p);\n      }\n      const oldStat = this._readable.statSync(p, isLstat).clone();\n      // Make the oldStat's mode writable. Preserve the topmost part of the\n      // mode, which specifies if it is a file or a directory.\n      oldStat.mode = makeModeWritable(oldStat.mode);\n      return oldStat;\n    }\n  }\n\n  public open(p: string, flag: FileFlag, mode: number, cb: BFSCallback<File>): void {\n    if (!this.checkInitAsync(cb) || this.checkPathAsync(p, cb)) {\n      return;\n    }\n    this.stat(p, false, (err: ApiError, stats?: Stats) => {\n      if (stats) {\n        switch (flag.pathExistsAction()) {\n        case ActionType.TRUNCATE_FILE:\n          return this.createParentDirectoriesAsync(p, (err?: ApiError) => {\n            if (err) {\n              return cb(err);\n            }\n            this._writable.open(p, flag, mode, cb);\n          });\n        case ActionType.NOP:\n          return this._writable.exists(p, (exists: boolean) => {\n            if (exists) {\n              this._writable.open(p, flag, mode, cb);\n            } else {\n              // at this point we know the stats object we got is from\n              // the readable FS.\n              stats = stats!.clone();\n              stats.mode = mode;\n              this._readable.readFile(p, null, getFlag('r'), (readFileErr: ApiError, data?: any) => {\n                if (readFileErr) {\n                  return cb(readFileErr);\n                }\n                if (stats!.size === -1) {\n                  stats!.size = data.length;\n                }\n                const f = new OverlayFile(this, p, flag, stats!, data);\n                cb(null, f);\n              });\n            }\n          });\n        default:\n          return cb(ApiError.EEXIST(p));\n        }\n      } else {\n        switch (flag.pathNotExistsAction()) {\n        case ActionType.CREATE_FILE:\n          return this.createParentDirectoriesAsync(p, (err?: ApiError) => {\n            if (err) {\n              return cb(err);\n            }\n            return this._writable.open(p, flag, mode, cb);\n          });\n        default:\n          return cb(ApiError.ENOENT(p));\n        }\n      }\n    });\n  }\n\n  public openSync(p: string, flag: FileFlag, mode: number): File {\n    this.checkInitialized();\n    this.checkPath(p);\n    if (p === deletionLogPath) {\n      throw ApiError.EPERM('Cannot open deletion log.');\n    }\n    if (this.existsSync(p)) {\n      switch (flag.pathExistsAction()) {\n        case ActionType.TRUNCATE_FILE:\n          this.createParentDirectories(p);\n          return this._writable.openSync(p, flag, mode);\n        case ActionType.NOP:\n          if (this._writable.existsSync(p)) {\n            return this._writable.openSync(p, flag, mode);\n          } else {\n            // Create an OverlayFile.\n            const buf = this._readable.readFileSync(p, null, getFlag('r'));\n            const stats = this._readable.statSync(p, false).clone();\n            stats.mode = mode;\n            return new OverlayFile(this, p, flag, stats, buf);\n          }\n        default:\n          throw ApiError.EEXIST(p);\n      }\n    } else {\n      switch (flag.pathNotExistsAction()) {\n        case ActionType.CREATE_FILE:\n          this.createParentDirectories(p);\n          return this._writable.openSync(p, flag, mode);\n        default:\n          throw ApiError.ENOENT(p);\n      }\n    }\n  }\n\n  public unlink(p: string, cb: BFSOneArgCallback): void {\n    if (!this.checkInitAsync(cb) || this.checkPathAsync(p, cb)) {\n      return;\n    }\n    this.exists(p, (exists: boolean) => {\n      if (!exists) {\n        return cb(ApiError.ENOENT(p));\n      }\n\n      this._writable.exists(p, (writableExists: boolean) => {\n        if (writableExists) {\n          return this._writable.unlink(p, (err: ApiError) => {\n            if (err) {\n              return cb(err);\n            }\n\n            this.exists(p, (readableExists: boolean) => {\n              if (readableExists) {\n                this.deletePath(p);\n              }\n              cb(null);\n            });\n          });\n        } else {\n          // if this only exists on the readable FS, add it to the\n          // delete map.\n          this.deletePath(p);\n          cb(null);\n        }\n      });\n    });\n  }\n\n  public unlinkSync(p: string): void {\n    this.checkInitialized();\n    this.checkPath(p);\n    if (this.existsSync(p)) {\n      if (this._writable.existsSync(p)) {\n        this._writable.unlinkSync(p);\n      }\n\n      // if it still exists add to the delete log\n      if (this.existsSync(p)) {\n        this.deletePath(p);\n      }\n    } else {\n      throw ApiError.ENOENT(p);\n    }\n  }\n\n  public rmdir(p: string, cb: BFSOneArgCallback): void {\n    if (!this.checkInitAsync(cb)) {\n      return;\n    }\n\n    const rmdirLower = (): void => {\n      this.readdir(p, (err: ApiError, files: string[]): void => {\n        if (err) {\n          return cb(err);\n        }\n\n        if (files.length) {\n          return cb(ApiError.ENOTEMPTY(p));\n        }\n\n        this.deletePath(p);\n        cb(null);\n      });\n    };\n\n    this.exists(p, (exists: boolean) => {\n      if (!exists) {\n        return cb(ApiError.ENOENT(p));\n      }\n\n      this._writable.exists(p, (writableExists: boolean) => {\n        if (writableExists) {\n          this._writable.rmdir(p, (err: ApiError) => {\n            if (err) {\n              return cb(err);\n            }\n\n            this._readable.exists(p, (readableExists: boolean) => {\n              if (readableExists) {\n                rmdirLower();\n              } else {\n                cb();\n              }\n            });\n          });\n        } else {\n          rmdirLower();\n        }\n      });\n    });\n  }\n\n  public rmdirSync(p: string): void {\n    this.checkInitialized();\n    if (this.existsSync(p)) {\n      if (this._writable.existsSync(p)) {\n        this._writable.rmdirSync(p);\n      }\n      if (this.existsSync(p)) {\n        // Check if directory is empty.\n        if (this.readdirSync(p).length > 0) {\n          throw ApiError.ENOTEMPTY(p);\n        } else {\n          this.deletePath(p);\n        }\n      }\n    } else {\n      throw ApiError.ENOENT(p);\n    }\n  }\n\n  public mkdir(p: string, mode: number, cb: BFSCallback<Stats>): void {\n    if (!this.checkInitAsync(cb)) {\n      return;\n    }\n    this.exists(p, (exists: boolean) => {\n      if (exists) {\n        return cb(ApiError.EEXIST(p));\n      }\n\n      // The below will throw should any of the parent directories\n      // fail to exist on _writable.\n      this.createParentDirectoriesAsync(p, (err: ApiError) => {\n        if (err) {\n          return cb(err);\n        }\n        this._writable.mkdir(p, mode, cb);\n      });\n    });\n  }\n\n  public mkdirSync(p: string, mode: number): void {\n    this.checkInitialized();\n    if (this.existsSync(p)) {\n      throw ApiError.EEXIST(p);\n    } else {\n      // The below will throw should any of the parent directories fail to exist\n      // on _writable.\n      this.createParentDirectories(p);\n      this._writable.mkdirSync(p, mode);\n    }\n  }\n\n  public readdir(p: string, cb: BFSCallback<string[]>): void {\n    if (!this.checkInitAsync(cb)) {\n      return;\n    }\n    this.stat(p, false, (err: ApiError, dirStats?: Stats) => {\n      if (err) {\n        return cb(err);\n      }\n\n      if (!dirStats!.isDirectory()) {\n        return cb(ApiError.ENOTDIR(p));\n      }\n\n      this._writable.readdir(p, (err: ApiError, wFiles: string[]) => {\n        if (err && err.code !== 'ENOENT') {\n          return cb(err);\n        } else if (err || !wFiles) {\n          wFiles = [];\n        }\n\n        this._readable.readdir(p, (err: ApiError, rFiles: string[]) => {\n          // if the directory doesn't exist on the lower FS set rFiles\n          // here to simplify the following code.\n          if (err || !rFiles) {\n            rFiles = [];\n          }\n\n          // Readdir in both, check delete log on read-only file system's files, merge, return.\n          const seenMap: {[name: string]: boolean} = {};\n          const filtered: string[] = wFiles.concat(rFiles.filter((fPath: string) =>\n            !this._deletedFiles[`${p}/${fPath}`]\n          )).filter((fPath: string) => {\n            // Remove duplicates.\n            const result = !seenMap[fPath];\n            seenMap[fPath] = true;\n            return result;\n          });\n          cb(null, filtered);\n        });\n      });\n    });\n  }\n\n  public readdirSync(p: string): string[] {\n    this.checkInitialized();\n    const dirStats = this.statSync(p, false);\n    if (!dirStats.isDirectory()) {\n      throw ApiError.ENOTDIR(p);\n    }\n\n    // Readdir in both, check delete log on RO file system's listing, merge, return.\n    let contents: string[] = [];\n    try {\n      contents = contents.concat(this._writable.readdirSync(p));\n    } catch (e) {\n      // NOP.\n    }\n    try {\n      contents = contents.concat(this._readable.readdirSync(p).filter((fPath: string) =>\n        !this._deletedFiles[`${p}/${fPath}`]\n      ));\n    } catch (e) {\n      // NOP.\n    }\n    const seenMap: {[name: string]: boolean} = {};\n    return contents.filter((fileP: string) => {\n      const result = !seenMap[fileP];\n      seenMap[fileP] = true;\n      return result;\n    });\n  }\n\n  public exists(p: string, cb: (exists: boolean) => void): void {\n    // Cannot pass an error back to callback, so throw an exception instead\n    // if not initialized.\n    this.checkInitialized();\n    this._writable.exists(p, (existsWritable: boolean) => {\n      if (existsWritable) {\n        return cb(true);\n      }\n\n      this._readable.exists(p, (existsReadable: boolean) => {\n        cb(existsReadable && this._deletedFiles[p] !== true);\n      });\n    });\n  }\n\n  public existsSync(p: string): boolean {\n    this.checkInitialized();\n    return this._writable.existsSync(p) || (this._readable.existsSync(p) && this._deletedFiles[p] !== true);\n  }\n\n  public chmod(p: string, isLchmod: boolean, mode: number, cb: BFSOneArgCallback): void {\n    if (!this.checkInitAsync(cb)) {\n      return;\n    }\n    this.operateOnWritableAsync(p, (err?: ApiError) => {\n      if (err) {\n        return cb(err);\n      } else {\n        this._writable.chmod(p, isLchmod, mode, cb);\n      }\n    });\n  }\n\n  public chmodSync(p: string, isLchmod: boolean, mode: number): void {\n    this.checkInitialized();\n    this.operateOnWritable(p, () => {\n      this._writable.chmodSync(p, isLchmod, mode);\n    });\n  }\n\n  public chown(p: string, isLchmod: boolean, uid: number, gid: number, cb: BFSOneArgCallback): void {\n    if (!this.checkInitAsync(cb)) {\n      return;\n    }\n    this.operateOnWritableAsync(p, (err?: ApiError) => {\n      if (err) {\n        return cb(err);\n      } else {\n        this._writable.chown(p, isLchmod, uid, gid, cb);\n      }\n    });\n  }\n\n  public chownSync(p: string, isLchown: boolean, uid: number, gid: number): void {\n    this.checkInitialized();\n    this.operateOnWritable(p, () => {\n      this._writable.chownSync(p, isLchown, uid, gid);\n    });\n  }\n\n  public utimes(p: string, atime: Date, mtime: Date, cb: BFSOneArgCallback): void {\n    if (!this.checkInitAsync(cb)) {\n      return;\n    }\n    this.operateOnWritableAsync(p, (err?: ApiError) => {\n      if (err) {\n        return cb(err);\n      } else {\n        this._writable.utimes(p, atime, mtime, cb);\n      }\n    });\n  }\n\n  public utimesSync(p: string, atime: Date, mtime: Date): void {\n    this.checkInitialized();\n    this.operateOnWritable(p, () => {\n      this._writable.utimesSync(p, atime, mtime);\n    });\n  }\n\n  private deletePath(p: string): void {\n    this._deletedFiles[p] = true;\n    this.updateLog(`d${p}\\n`);\n  }\n\n  private updateLog(addition: string) {\n    this._deleteLog += addition;\n    if (this._deleteLogUpdatePending) {\n      this._deleteLogUpdateNeeded = true;\n    } else {\n      this._deleteLogUpdatePending = true;\n      this._writable.writeFile(deletionLogPath, this._deleteLog, 'utf8', FileFlag.getFileFlag('w'), 0o644, (e) => {\n        this._deleteLogUpdatePending = false;\n        if (e) {\n          this._deleteLogError = e;\n        } else if (this._deleteLogUpdateNeeded) {\n          this._deleteLogUpdateNeeded = false;\n          this.updateLog('');\n        }\n      });\n    }\n  }\n\n  private _reparseDeletionLog(): void {\n    this._deletedFiles = {};\n    this._deleteLog.split('\\n').forEach((path: string) => {\n      // If the log entry begins w/ 'd', it's a deletion.\n      this._deletedFiles[path.slice(1)] = path.slice(0, 1) === 'd';\n    });\n  }\n\n  private checkInitialized(): void {\n    if (!this._isInitialized) {\n      throw new ApiError(ErrorCode.EPERM, \"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.\");\n    } else if (this._deleteLogError !== null) {\n      const e = this._deleteLogError;\n      this._deleteLogError = null;\n      throw e;\n    }\n  }\n\n  private checkInitAsync(cb: BFSOneArgCallback): boolean {\n    if (!this._isInitialized) {\n      cb(new ApiError(ErrorCode.EPERM, \"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.\"));\n      return false;\n    } else if (this._deleteLogError !== null) {\n      const e = this._deleteLogError;\n      this._deleteLogError = null;\n      cb(e);\n      return false;\n    }\n    return true;\n  }\n\n  private checkPath(p: string): void {\n    if (p === deletionLogPath) {\n      throw ApiError.EPERM(p);\n    }\n  }\n\n  private checkPathAsync(p: string, cb: BFSOneArgCallback): boolean {\n    if (p === deletionLogPath) {\n      cb(ApiError.EPERM(p));\n      return true;\n    }\n    return false;\n  }\n\n  private createParentDirectoriesAsync(p: string, cb: BFSOneArgCallback): void {\n    let parent = path.dirname(p);\n    const toCreate: string[] = [];\n    const self = this;\n\n    this._writable.stat(parent, false, statDone);\n    function statDone(err: ApiError, stat?: Stats): void {\n      if (err) {\n        toCreate.push(parent);\n        parent = path.dirname(parent);\n        self._writable.stat(parent, false, statDone);\n      } else {\n        createParents();\n      }\n    }\n\n    function createParents(): void {\n      if (!toCreate.length) {\n        return cb();\n      }\n\n      const dir = toCreate.pop();\n      self._readable.stat(dir!, false, (err: ApiError, stats?: Stats) => {\n        // stop if we couldn't read the dir\n        if (!stats) {\n          return cb();\n        }\n\n        self._writable.mkdir(dir!, stats.mode, (err?: ApiError) => {\n          if (err) {\n            return cb(err);\n          }\n          createParents();\n        });\n      });\n    }\n  }\n\n  /**\n   * With the given path, create the needed parent directories on the writable storage\n   * should they not exist. Use modes from the read-only storage.\n   */\n  private createParentDirectories(p: string): void {\n    let parent = path.dirname(p), toCreate: string[] = [];\n    while (!this._writable.existsSync(parent)) {\n      toCreate.push(parent);\n      parent = path.dirname(parent);\n    }\n    toCreate = toCreate.reverse();\n\n    toCreate.forEach((p: string) => {\n      this._writable.mkdirSync(p, this.statSync(p, false).mode);\n    });\n  }\n\n  /**\n   * Helper function:\n   * - Ensures p is on writable before proceeding. Throws an error if it doesn't exist.\n   * - Calls f to perform operation on writable.\n   */\n  private operateOnWritable(p: string, f: () => void): void {\n    if (this.existsSync(p)) {\n      if (!this._writable.existsSync(p)) {\n        // File is on readable storage. Copy to writable storage before\n        // changing its mode.\n        this.copyToWritable(p);\n      }\n      f();\n    } else {\n      throw ApiError.ENOENT(p);\n    }\n  }\n\n  private operateOnWritableAsync(p: string, cb: BFSOneArgCallback): void {\n    this.exists(p, (exists: boolean) => {\n      if (!exists) {\n        return cb(ApiError.ENOENT(p));\n      }\n\n      this._writable.exists(p, (existsWritable: boolean) => {\n        if (existsWritable) {\n          cb();\n        } else {\n          return this.copyToWritableAsync(p, cb);\n        }\n      });\n    });\n  }\n\n  /**\n   * Copy from readable to writable storage.\n   * PRECONDITION: File does not exist on writable storage.\n   */\n  private copyToWritable(p: string): void {\n    const pStats = this.statSync(p, false);\n    if (pStats.isDirectory()) {\n      this._writable.mkdirSync(p, pStats.mode);\n    } else {\n      this.writeFileSync(p,\n        this._readable.readFileSync(p, null, getFlag('r')), null,\n        getFlag('w'), this.statSync(p, false).mode);\n    }\n  }\n\n  private copyToWritableAsync(p: string, cb: BFSOneArgCallback): void {\n    this.stat(p, false, (err: ApiError, pStats?: Stats) => {\n      if (err) {\n        return cb(err);\n      }\n\n      if (pStats!.isDirectory()) {\n        return this._writable.mkdir(p, pStats!.mode, cb);\n      }\n\n      // need to copy file.\n      this._readable.readFile(p, null, getFlag('r'), (err: ApiError, data?: Buffer) => {\n        if (err) {\n          return cb(err);\n        }\n\n        this.writeFile(p, data, null, getFlag('w'), pStats!.mode, cb);\n      });\n    });\n  }\n}\n\n/**\n * Configuration options for OverlayFS instances.\n */\nexport interface OverlayFSOptions {\n  // The file system to write modified files to.\n  writable: FileSystem;\n  // The file system that initially populates this file system.\n  readable: FileSystem;\n}\n\n/**\n * OverlayFS makes a read-only filesystem writable by storing writes on a second,\n * writable file system. Deletes are persisted via metadata stored on the writable\n * file system.\n */\nexport default class OverlayFS extends LockedFS<UnlockedOverlayFS> {\n  public static readonly Name = \"OverlayFS\";\n\n  public static readonly Options: FileSystemOptions = {\n    writable: {\n      type: \"object\",\n      description: \"The file system to write modified files to.\"\n    },\n    readable: {\n      type: \"object\",\n      description: \"The file system that initially populates this file system.\"\n    }\n  };\n\n  /**\n   * Constructs and initializes an OverlayFS instance with the given options.\n   */\n  public static Create(opts: OverlayFSOptions, cb: BFSCallback<OverlayFS>): void {\n    try {\n      const fs = new OverlayFS(opts.writable, opts.readable, false);\n      fs.initialize((e?) => {\n        cb(e, fs);\n      }, false);\n    } catch (e) {\n      cb(e);\n    }\n  }\n  public static isAvailable(): boolean {\n    return UnlockedOverlayFS.isAvailable();\n  }\n\n  /**\n   * **Deprecated. Please use OverlayFS.Create() method instead.**\n   * @param writable The file system to write modified files to.\n   * @param readable The file system that initially populates this file system.\n   */\n  constructor(writable: FileSystem, readable: FileSystem, deprecateMsg = true) {\n    super(new UnlockedOverlayFS(writable, readable));\n    deprecationMessage(deprecateMsg, OverlayFS.Name, {readable: \"readable file system\", writable: \"writable file system\"});\n  }\n\n  /**\n   * **Deprecated. Please use OverlayFS.Create() to construct and initialize OverlayFS instances.**\n   */\n  public initialize(cb: BFSOneArgCallback, deprecateMsg = true): void {\n    if (deprecateMsg) {\n      console.warn(`[OverlayFS] OverlayFS.initialize() is deprecated and will be removed in the next major release. Please use 'OverlayFS.Create({readable: readable file system instance, writable: writable file system instance}, cb)' to create and initialize OverlayFS instances.`);\n    }\n    super.initialize(cb);\n  }\n\n  public getOverlayedFileSystems(): { readable: FileSystem; writable: FileSystem; } {\n    return super.getFSUnlocked().getOverlayedFileSystems();\n  }\n\n  public unwrap(): UnlockedOverlayFS {\n    return super.getFSUnlocked();\n  }\n}\n"]}