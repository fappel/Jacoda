{"version":3,"file":"api_error.js","sourceRoot":"","sources":["../../../../../src/core/api_error.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Standard libc error codes. Add more to this enum and ErrorStrings as they are\n * needed.\n * @url http://www.gnu.org/software/libc/manual/html_node/Error-Codes.html\n */\nexport enum ErrorCode {\n  EPERM     = 1,\n  ENOENT    = 2,\n  EIO       = 5,\n  EBADF     = 9,\n  EACCES    = 13,\n  EBUSY     = 16,\n  EEXIST    = 17,\n  ENOTDIR   = 20,\n  EISDIR    = 21,\n  EINVAL    = 22,\n  EFBIG     = 27,\n  ENOSPC    = 28,\n  EROFS     = 30,\n  ENOTEMPTY = 39,\n  ENOTSUP   = 95,\n}\n/* tslint:disable:variable-name */\n/**\n * Strings associated with each error code.\n * @hidden\n */\nexport const ErrorStrings: {[code: string]: string; [code: number]: string; } = {};\nErrorStrings[ErrorCode.EPERM] = 'Operation not permitted.';\nErrorStrings[ErrorCode.ENOENT] = 'No such file or directory.';\nErrorStrings[ErrorCode.EIO] = 'Input/output error.';\nErrorStrings[ErrorCode.EBADF] = 'Bad file descriptor.';\nErrorStrings[ErrorCode.EACCES] = 'Permission denied.';\nErrorStrings[ErrorCode.EBUSY] = 'Resource busy or locked.';\nErrorStrings[ErrorCode.EEXIST] = 'File exists.';\nErrorStrings[ErrorCode.ENOTDIR] = 'File is not a directory.';\nErrorStrings[ErrorCode.EISDIR] = 'File is a directory.';\nErrorStrings[ErrorCode.EINVAL] = 'Invalid argument.';\nErrorStrings[ErrorCode.EFBIG] = 'File is too big.';\nErrorStrings[ErrorCode.ENOSPC] = 'No space left on disk.';\nErrorStrings[ErrorCode.EROFS] = 'Cannot modify a read-only file system.';\nErrorStrings[ErrorCode.ENOTEMPTY] = 'Directory is not empty.';\nErrorStrings[ErrorCode.ENOTSUP] = 'Operation is not supported.';\n/* tslint:enable:variable-name */\n\n/**\n * Represents a BrowserFS error. Passed back to applications after a failed\n * call to the BrowserFS API.\n */\nexport class ApiError extends Error implements NodeJS.ErrnoException {\n  public static fromJSON(json: any): ApiError {\n    const err = new ApiError(0);\n    err.errno = json.errno;\n    err.code = json.code;\n    err.path = json.path;\n    err.stack = json.stack;\n    err.message = json.message;\n    return err;\n  }\n\n  /**\n   * Creates an ApiError object from a buffer.\n   */\n  public static fromBuffer(buffer: Buffer, i: number = 0): ApiError {\n    return ApiError.fromJSON(JSON.parse(buffer.toString('utf8', i + 4, i + 4 + buffer.readUInt32LE(i))));\n  }\n\n  public static FileError(code: ErrorCode, p: string): ApiError {\n    return new ApiError(code, ErrorStrings[code], p);\n  }\n  public static ENOENT(path: string): ApiError {\n    return this.FileError(ErrorCode.ENOENT, path);\n  }\n\n  public static EEXIST(path: string): ApiError {\n    return this.FileError(ErrorCode.EEXIST, path);\n  }\n\n  public static EISDIR(path: string): ApiError {\n    return this.FileError(ErrorCode.EISDIR, path);\n  }\n\n  public static ENOTDIR(path: string): ApiError {\n    return this.FileError(ErrorCode.ENOTDIR, path);\n  }\n\n  public static EPERM(path: string): ApiError {\n    return this.FileError(ErrorCode.EPERM, path);\n  }\n\n  public static ENOTEMPTY(path: string): ApiError {\n    return this.FileError(ErrorCode.ENOTEMPTY, path);\n  }\n\n  public errno: ErrorCode;\n  public code: string;\n  public path: string | undefined;\n  // Unsupported.\n  public syscall: string = \"\";\n  public stack: string | undefined;\n\n  /**\n   * Represents a BrowserFS error. Passed back to applications after a failed\n   * call to the BrowserFS API.\n   *\n   * Error codes mirror those returned by regular Unix file operations, which is\n   * what Node returns.\n   * @constructor ApiError\n   * @param type The type of the error.\n   * @param [message] A descriptive error message.\n   */\n  constructor(type: ErrorCode, message: string = ErrorStrings[type], path?: string) {\n    super(message);\n    this.errno = type;\n    this.code = ErrorCode[type];\n    this.path = path;\n    this.stack = new Error().stack;\n    this.message = `Error: ${this.code}: ${message}${this.path ? `, '${this.path}'` : ''}`;\n  }\n\n  /**\n   * @return A friendly error message.\n   */\n  public toString(): string {\n    return this.message;\n  }\n\n  public toJSON(): any {\n    return {\n      errno: this.errno,\n      code: this.code,\n      path: this.path,\n      stack: this.stack,\n      message: this.message\n    };\n  }\n\n  /**\n   * Writes the API error into a buffer.\n   */\n  public writeToBuffer(buffer: Buffer = Buffer.alloc(this.bufferSize()), i: number = 0): Buffer {\n    const bytesWritten = buffer.write(JSON.stringify(this.toJSON()), i + 4);\n    buffer.writeUInt32LE(bytesWritten, i);\n    return buffer;\n  }\n\n  /**\n   * The size of the API error in buffer-form in bytes.\n   */\n  public bufferSize(): number {\n    // 4 bytes for string length.\n    return 4 + Buffer.byteLength(JSON.stringify(this.toJSON()));\n  }\n}\n"]}